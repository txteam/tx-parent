/**
* jQuery EasyUI 1.3.3
* Copyright (c) 2009-2013 www.jeasyui.com. All rights reserved.
*
* Licensed under the GPL or commercial licenses
* To use it on other terms please contact us: jeasyui@gmail.com
* http://www.gnu.org/licenses/gpl.txt
* http://www.jeasyui.com/license_commercial.php
*
* jQuery EasyUI datagrid Extensions 1.0 beta
* jQuery EasyUI datagrid 组件扩展
* jeasyui.extensions.datagrid.js
* 二次开发 陈建伟
* 最近更新：2013-06-03
*
* 依赖项：
*   1、jquery.jdirk.js v1.0 beta late
*   2、jeasyui.extensions.js v1.0 beta late
*   3、jeasyui.extensions.menu.js v1.0 beta late
*   4、jeasyui.extensions.window.js v1.0 beta late(可选)
*
* Copyright (c) 2013 ChenJianwei personal All rights reserved.
* http://www.chenjianwei.org
*/
!function(a){function t(b,c,d,e,f,g,h){g=g?g:b.datagrid("getRows"),a.each(e,function(){var c=a.array.indexOf(g,this);f?(b.datagrid("getRowDom",c).show(),a.array.contains(d.filterData,this)&&a.array.remove(d.filterData,this)):(b.datagrid("unselectRow",c),b.datagrid("uncheckRow",c),b.datagrid("getRowDom",c).hide(),a.array.attach(d.filterData,this))}),v(b,c,d,g,h)}function u(b,c,d){var f,g,h,i,j,k,m,n,p,e=b.datagrid("hasMuliRowHeader");E(b),!e&&c.columnFilter&&a.util.likeArray(c.columnFilter.columns)&&(f=b.datagrid("getPanel"),g=f.find("div.datagrid-view"),h=g.find("div.datagrid-header"),i=h.find("table.datagrid-htable"),j=i.find("tr.datagrid-header-row"),k=j.find("td").filter(function(){return a("div.datagrid-header-check,div.datagrid-header-rownumber",this).length?!1:!0}),k.find("div.datagrid-cell"),m=c.columnFilter=a.extend({panelHeight:160,position:"top",columns:null},c.columnFilter),n=String(m.position).toLowerCase(),h.height(),(!a.isNumeric(m.panelHeight)||m.panelHeight<80)&&(m.panelHeight=80),p=b.datagrid("getRows"),k.each(function(e,f){var q,r,g=a(this),i=(g.find("div.datagrid-cell"),g.attr("field")),j=b.datagrid("getColumnOption",i),l=j.width;a("<hr />").addClass("datagrid-header-filter-line")["top"==n?"prependTo":"appendTo"](f),g.addClass("datagrid-header-filter"),q=a("<div></div>").attr("field",i).addClass("datagrid-header-filter-container").css({height:m.panelHeight,width:l})["top"==n?"prependTo":"appendTo"](f),r=a.array.filter(m.columns,function(a){return a&&a.field==i?!0:!1}),r=r.length?r[0]:null,A(b,c,d,q,i,r,p,k)}),v(b,c,d,p,k))}function v(b,c,d,e,f){f=f?f:b.datagrid("getPanel").find("div.datagrid-view div.datagrid-header table.datagrid-htable tr.datagrid-header-row td").filter(function(){return a("div.datagrid-header-check,div.datagrid-header-rownumber",this).length?!1:!0}),f.each(function(){var i,f=a(this),g=f.attr("field"),h=c.columnFilter&&a.util.likeArray(c.columnFilter.columns)?a.array.filter(c.columnFilter.columns,function(a){return a&&a.field==g?!0:!1}):[];switch(h=h.length?h[0]:null,h=a.extend({field:g,type:"checkbox",precision:1},h||{}),i=String(h.type).toLowerCase(),h.precision,i){case"checkbox":w(b,d,e,f,g);break;case"slidercaps":y(b,d,e,f,g);break;case"sliderlower":z(b,d,e,f,g);break;case"none":break;default:w(b,e,f,g)}})}function w(b,c,d,e,f){e.find("div.datagrid-header-filter-item").each(function(){var b=a(this),e=b.attr("text"),g=b.find("div.datagrid-header-filter-item-icon"),h=a.array.filter(d,function(a){return a[f]==e}),i=h.length,j=a.array.filter(c.filterData,function(a){return a[f]==e}),k=j.length,l=0==k?"tree-checkbox1":k>=i?"tree-checkbox0":"tree-checkbox2";b.mouseover(function(){b.tooltip({content:(a.string.isNullOrEmpty(e)?"空白":e)+": 共"+i+"个元素",onHide:function(){a.util.parseJquery(this).tooltip("destroy")}}).tooltip("show")}),x(g,l)})}function x(a,b){a.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2").addClass(b)}function y(){}function z(){}function A(b,c,d,e,f,g,h,i){var j,k,l,m;switch(g=a.extend({field:f,type:"checkbox",precision:1,step:1},g||{}),j=a.array.clone(h),a.array.distinct(j,function(a,b){return a[f]==b[f]}),k=String(g.type).toLowerCase(),l=g.precision,m=g.step,k){case"checkbox":B(b,c,d,e,f,h,j,i);break;case"slidercaps":D(b,c,d,e,f,m,l,h,j,"<=",i);break;case"sliderlower":D(b,c,d,e,f,m,l,h,j,">=",i);break;case"none":break;default:B(b,c,d,e,f,h,j,i)}}function B(b,c,d,e,f,g,h,i){a.each(h,function(){var m,h=this[f],j=a("<div></div>").addClass("datagrid-header-filter-item").attr("text",h).appendTo(e);a("<div></div>").addClass("datagrid-header-filter-item-text").text(h).appendTo(j),a("<div></div>").addClass("datagrid-header-filter-item-icon").appendTo(j),m=function(){var e=a.array.filter(g,function(a){return a[f]==h}),j=a.array.filter(d.filterData,function(a){return a[f]==h}),k=j.length;t(b,c,d,e,k?!0:!1,g,i)},j.click(m)})}function C(b,c,d,e,f,g,h,i,j,k){var l,m;i=i?i:b.datagrid("getPanel").find("div.datagrid-view div.datagrid-header table.datagrid-htable tr.datagrid-header-row td").filter(function(){return a("div.datagrid-header-check,div.datagrid-header-rownumber",this).length?!1:!0}),l=i.filter(function(){return a(this).attr("field")==e}),j=j?j:l.find(".datagrid-header-filter-numeric"),k=k?k:l.find(".datagrid-header-filter-slider"),m=a.array.filter(f,function(b){return b=parseFloat(b[e]),b=a.isNumeric(b)?b:0,">="==h?g>b:b>g}),b.datagrid("getPanel").find(".datagrid-view .datagrid-body tr.datagrid-row").show(),d.filterData=[],a.each(m,function(){var c=a.array.indexOf(f,this);b.datagrid("getRowDom",c).hide(),a.array.attach(d.filterData,this)}),v(b,c,d,f,i),j.numberbox("setValue",g),k.slider("setValue",g)}function D(b,c,d,e,f,g,h,i,j,k,l){var m=a.array.map(j,function(b){return b=parseFloat(b[f]),a.isNumeric(b)?b:0}),n=a.array.min(m),o=a.array.max(m),p=a.array.max(m,function(b,c){a.util.compare(a.number.precision(b),a.number.precision(c))}),q=a.number.precision(p),r=c.columnFilter.panelHeight-45,s=a("<div></div>").addClass("datagrid-header-filter-itemwrap").text(k).appendTo(e),t=a("<div></div>").addClass("datagrid-header-filter-sliderwrap").css({height:r+10})["<="==k?"appendTo":"prependTo"](e),u=a("<input />").addClass("datagrid-header-filter-numeric").appendTo(s),v=a("<input />").addClass("datagrid-header-filter-slider").appendTo(t),w=function(a){C(b,c,d,f,i,a,"<=",l,u,v)};s.append("<br /><br />"),u.numberbox({value:"<="==k?o:n,min:n,max:o,precision:h,onChange:w}),v.slider({height:r,mode:"v",showTip:!0,value:"<="==k?o:n,min:n,max:o,rule:[n,"|",o],step:g,onSlideEnd:w,tipFormatter:function(b){return a.number.round(b,q)}})}function E(b){var d,c=c?c:b.datagrid("getPanel").find("div.datagrid-view div.datagrid-header table.datagrid-htable tr.datagrid-header-row td").filter(function(){return a("div.datagrid-header-check,div.datagrid-header-rownumber",this).length?!1:!0});c.find("hr.datagrid-header-filter-line,div.datagrid-header-filter-container").remove(),d=b.datagrid("getColumnFields",!0),a.util.merge(d,b.datagrid("getColumnFields",!1)),b.datagrid("fixColumnSize",d[d.length-1])}function H(b,c,d,e,f,g){var i,j,h=a.util.likeArray(c.headerContextMenu)&&!a.util.isString(c.headerContextMenu)?c.headerContextMenu:[];return h=N(e,f,g,h),i=J(b,c,d,e,f,g),i=N(e,f,g,i),j={items:h},j.items.length&&a.util.merge(j.items,"-"),a.util.merge(j.items,i),j}function I(b,c,d,e,f,g,h){var j,k,i=a.util.likeArray(c.rowContextMenu)&&!a.util.isString(c.rowContextMenu)?c.rowContextMenu:[];return i=O(e,f,g,h,i),j=M(b,c,d,e,f,g,h),j=O(e,f,g,h,j),k={items:i},k.items.length&&a.util.merge(k.items,"-"),a.util.merge(k.items,j),k}function J(b,c,d,e,f,g){var h=[],i=b.datagrid("getColumnOption",f),j=b.datagrid("getColumnOption",f).sortable,k={text:"升序",iconCls:"icon-menu-asc",disabled:1!=j,handler:function(){return b.datagrid("sort",{sortName:f,sortOrder:"asc"})}},l={text:"降序",iconCls:"icon-menu-desc",disabled:1!=j,handler:function(){return b.datagrid("sort",{sortName:f,sortOrder:"desc"})}},m={text:"显示/隐藏列",iconCls:"icon-columns",disabled:!1,children:[{text:"显示全部列",iconCls:"icon-columns",handler:function(){a.each(d.fields,function(){b.datagrid("showColumn",this)})}},{text:"还原默认",iconCls:"icon-grid",handler:function(){a.each(d.fieldOptions,function(){b.datagrid(1==this.hidden?"hideColumn":"showColumn",this.field)})}},"-"]},n={text:"过滤/显示",iconCls:"icon-filter",disabled:i.disabledFilter?!0:!1,children:[]},o={text:"导出数据",iconCls:"icon-export",disabled:!1,children:[{text:"导出当前页",iconCls:"icon-export-current",handler:function(){return b.datagrid("exportExcel",!1)}},{text:"导出全部",iconCls:"icon-export-all",handler:function(){return b.datagrid("exportExcel",!0)}}]};return a.util.merge(m.children,K(b,c,d,e,f,g)),i.disabledFilter||a.util.merge(n.children,L(b,c,d,e,f,g)),a.util.merge(h,[k,l,"-",m,n]),c.enableExport&&a.util.merge(h,["-",o]),h}function K(b,c,d){return a.array.map(d.fields,function(c){var f=b.datagrid("getColumnOption",c),g=function(){var e=a.array.reduce(d.fields,function(a,c){var f=b.datagrid("getColumnOption",c);return a+(f.hidden?0:1)},0);(1!=e||f.hidden)&&b.datagrid(f.hidden?"showColumn":"hideColumn",c)};return{text:f.title||c,iconCls:f.hidden?"tree-checkbox0":"tree-checkbox1",disabled:!1,handler:g}})}function L(b,c,d,e,f){var l,m,n,o,p,h=b.datagrid("getRows"),i=a.array.clone(h),j=d.filterData.length,k=[{text:"全部",iconCls:0==j?"tree-checkbox1":j>=h.length?"tree-checkbox0":"tree-checkbox2",handler:function(){j?(b.datagrid("getPanel").find(".datagrid-view .datagrid-body tr.datagrid-row").show(),d.filterData=[]):(b.datagrid("getPanel").find(".datagrid-view .datagrid-body tr.datagrid-row").hide(),a.util.merge(d.filterData,h)),v(b,c,d,h)}},"-"];return a.array.distinct(i,function(a,b){return a[f]==b[f]}),l=i.length>=5,m=l?a.array.range(i,0,10):i,a.array.merge(k,a.array.map(m,function(e){var g=e[f],i=a.array.filter(h,function(a){return a[f]==g}),j=i.length,k=a.array.filter(d.filterData,function(a){return a[f]==g}),l=k.length,m=0==l?"tree-checkbox1":l>=j?"tree-checkbox0":"tree-checkbox2",n=function(){t(b,c,d,i,l?!0:!1,h)};return{text:g,iconCls:m,handler:n}})),l&&(n=b.datagrid("getColumnOption",f),o=n.title?n.title:n.field,p=function(){var g=a("<input />").attr({type:"button",value:"全部选择"}).click(function(){b.datagrid("columnFilterSelect",!0),a(this).parent().find(":checkbox").each(function(){this.checked=!0})}),j=a("<input />").attr({type:"button",value:"全部不选"}).click(function(){b.datagrid("columnFilterSelect",!1),a(this).parent().find(":checkbox").each(function(){this.checked=!1})});a("<div></div>").append("<div>列："+o+"，共"+i.length+"项</div><hr />").css({padding:"10px"}).append(g).append(j).append("<hr />").each(function(){var e=a(this);a.each(i,function(g){var o,i=this[f],j="itemCheckbox_"+a.util.guid().replaceAll("-",""),k=0==a.array.filter(d.filterData,function(a){return a[f]==i}).length?!0:!1,l=a("<div></div>").css({"white-space":"nowrap"}).appendTo(e).text(++g+"、"),m=a("<input />").attr({type:"checkbox",id:j,checked:k}).css({"margin-top":"-2px"}).appendTo(l);a("<label></label>").attr("for",j).text(i).appendTo(l),o=function(){var e=a.array.filter(h,function(a){return a[f]==i}),g=a.array.filter(d.filterData,function(a){return a[f]==i}),j=g.length;t(b,c,d,e,j?!0:!1,h)},m.click(o)})}).dialog({title:"过滤/显示",iconCls:"icon-window",height:260,width:220,collapsible:!1,minimizable:!1,maximizable:!1,closable:!0,modal:!0,resizable:!0,onClose:function(){a(this).dialog("destroy")}}).dialog("open").dialog("move",{left:e.pageX,top:e.pageY})},a.array.merge(k,["-",{text:"处理更多(共"+i.length+"项)...",iconCls:"icon-window",handler:p}])),k}function M(b,c,d,e,f,g,h){var i=[],j={text:"刷新当前页",iconCls:"pagination-load",disabled:!1,handler:function(){b.datagrid("reload")}},k={text:"首页",iconCls:"pagination-first",disabled:function(){return!c.pagination||h.page<=1},handler:function(){h.page>1&&h.pager.pagination("select",1)}},l={text:"上一页",iconCls:"pagination-prev",disabled:function(){return!c.pagination||h.page<=1},handler:function(){h.page>1&&h.pager.pagination("select",h.page-1)}},m={text:"下一页",iconCls:"pagination-next",disabled:function(){return!c.pagination||h.page>=h.pageCount},handler:function(){h.page<h.pageCount&&h.pager.pagination("select",h.page+1)}},n={text:"末页",iconCls:"pagination-last",disabled:function(){return!c.pagination||h.page>=h.pageCount},handler:function(){h.page<h.pageCount&&h.pager.pagination("select",h.pageCount)}},o={text:"导出数据",iconCls:"icon-export",disabled:!1,children:[{text:"导出当前页",iconCls:"icon-export-current",handler:function(){return b.datagrid("exportExcel",!1)}},{text:"导出全部",iconCls:"icon-export-all",handler:function(){return b.datagrid("exportExcel",!0)}}]};return a.util.merge(i,[j,"-",k,l,m,n]),c.enableExport&&a.util.merge(i,["-",o]),i}function N(b,c,d,e){return a.array.map(e,function(e){if(!e||a.util.isString(e))return e;var g=a.extend({},e);return g.id=a.isFunction(e.id)?e.id.call(g,b,c,d):e.id,g.text=a.isFunction(e.text)?e.text.call(g,b,c,d):e.text,g.iconCls=a.isFunction(e.iconCls)?e.iconCls.call(g,b,c,d):e.iconCls,g.disabled=a.isFunction(e.disabled)?e.disabled.call(e,b,c,d):e.disabled,g.onclick=a.isFunction(e.onclick)?function(){e.onclick.call(this,b,c,d)}:e.onclick,g.handler=a.isFunction(e.handler)?function(){e.handler.call(this,b,c,d)}:e.handler,g.children&&g.children.length&&(g.children=N(b,c,d,g.children)),g})}function O(b,c,d,e,f){return a.array.map(f,function(f){if(!f||a.util.isString(f))return f;var h=a.extend({},f);return h.id=a.isFunction(f.id)?f.id.call(h,b,c,d,e):f.id,h.text=a.isFunction(f.text)?f.text.call(h,b,c,d,e):f.text,h.iconCls=a.isFunction(f.iconCls)?f.iconCls.call(h,b,c,d,e):f.iconCls,h.disabled=a.isFunction(f.disabled)?f.disabled.call(f,b,c,d,e):f.disabled,h.onclick=a.isFunction(f.onclick)?function(){f.onclick.call(this,b,c,d,e)}:f.onclick,h.handler=a.isFunction(f.handler)?function(){f.handler.call(this,b,c,d,e)}:f.handler,h.children&&h.children.length&&(h.children=O(b,c,d,e,h.children)),h})}function P(b,c,d){var e=V(c),f=Q(b,c);return a.extend({},e,f,{e:d,datagrid:b})}function Q(b,c){var e,f,g,h,d={};return c.pagination&&(e=b.datagrid("getPager"),f=e.pagination("options"),g=f.total,h=Math.ceil(parseFloat(g)/parseFloat(f.pageSize)),a.extend(d,{pager:e,total:g,pageCount:h})),d}function S(b,c){function f(){o(b,d.offset,e)}function g(){F(b,d,e),G(b,d,e),R(b,d,e)}var d=c,e=d._extensions?d._extensions:d._extensions={};e._initialized||(e.fields=b.datagrid("getColumnFields",!1),e.fieldOptions=a.array.map(e.fields,function(c){return a.extend({},b.datagrid("getColumnOption",c))}),e.filterData=[],f(),g(),e._initialized=!0)}function T(b,c){return b=a.string.isNullOrWhiteSpace(b)?"":a.trim(b),c=a.string.isNullOrWhiteSpace(c)?"":a.trim(c),c=c.toLowerCase(),"asc"!=c&&"desc"!=c&&(c="asc"),a.trim(b+" "+c)}function U(b,c){var d=a.util.parseMapFunction(c);return b.pagination&&(d.pageNumber=d.page,d.pageSize=d.rows,d.pageIndex=d.pageNumber-1),d.orderby=T(d.sort,d.order),d}function V(b){var c=a.extend({},b.queryParams);return b.pagination&&a.extend(c,{page:b.pageNumber,rows:b.pageSize}),b.sortName&&a.extend(c,{sort:b.sortName,order:b.sortOrder}),c=U(b,c)}var bb,c=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("getRows");return a.isFunction(c)?ret=a.array.filter(e,function(a,b){return 1==c.call(this,b,a)},e):[]},d=function(b,d){var f,g,h,e=a.isFunction(d);return e?c(b,d)[0]:(f=a.util.parseJquery(b),g=f.datagrid("getRows"),h=a.isNumeric(d)?d:f.datagrid("getRowIndex",d),g[h])},e=a.fn.datagrid.methods.deleteRow,f=function(b,c){var d=a.util.parseJquery(b),f=a.isNumeric(c)?c:d.datagrid("getRowIndex",c);e.call(d,f)},g=function(b,e){var h,g=a.isFunction(e);if(g)h=c(b,e);else{if(!a.isArray(e))return f(b,e),void 0;h=a.array.map(e,function(a){return d(b,a)})}a.each(h,function(){f(b,this)})},h=function(b,c){var d,e;c&&c.field&&c.title&&(d=a.util.parseJquery(b).datagrid("getPanel"),e=a("td[field='"+c.field+"']",d),e.length&&a("span:first",e).html(c.title))},i=function(b,c){var d,e,f,g,h,i,j,k;c=c||{},c=a.extend({sortName:null,sortOrder:"asc"},c),d=a.util.parseJquery(b),e=a.data(b,"datagrid"),f=e.options,g=d.datagrid("getColumnOption",c.sortName),g&&!a.isEmptyObject(g)&&g.sortable&&!e.resizing&&(f.sortName=c.sortName,f.sortOrder=c.sortOrder,h="datagrid-sort-"+f.sortOrder,i=d.datagrid("getPanel").find(".datagrid-view .datagrid-header td div.datagrid-cell"),j=d.datagrid("getPanel").find(".datagrid-view .datagrid-header td[field='"+c.sortName+"'] div.datagrid-cell"),i.length&&j.length&&(i.removeClass("datagrid-sort-asc datagrid-sort-desc"),j.addClass(h),f.remoteSort?d.datagrid("reload"):(k=a.data(b,"datagrid").data,d.datagrid("loadData",k)),f.onSortColumn.call(b,f.sortName,f.sortOrder)))},j=function(b,c){return!c||!c.field||!a.isNumeric(c.index)||c.index<0?a.util.$$:m(b,c.index).find("td[field="+c.field+"] .datagrid-cell")},k=function(b,c){return c&&c.field&&a.isNumeric(c.index)&&!(c.index<0)?n(b,c.index)[c.field]:void 0},l=function(b,c){var d=j(b,c);return d==a.util.$$?null:d.text()},m=function(b,c){if(!a.isNumeric(c)||0>c)return a.util.$$;var d=a.util.parseJquery(b),e=d.datagrid("getPanel");return e.find(".datagrid-view .datagrid-body tr.datagrid-row[datagrid-row-index="+c+"]")},n=function(b,c){if(!a.isNumeric(c)||0>c)return null;var d=a.util.parseJquery(b),e=d.datagrid("getRows");return e[c]},o=function(b,c,d){function g(b){var c={enable:b?!0:!1};return c.enable&&a.extend(c,b),c.width=a.isNumeric(c.width)?c.width:0,c.height=a.isNumeric(c.height)?c.height:0,c}var e=a.util.parseJquery(b),f=e.datagrid("options"),d=d?d:f._extensions?f._extensions:f._extensions={};d.offset=g(c),d.offset&&d.offset.enable&&(a.isFunction(d.offsetFunction)||(d.offsetFunction=function(){if(d.offset.enable){var b=a.util.windowSize();e.datagrid("resize",{width:b.width+d.offset.width,height:b.height+d.offset.height})}},a(window).resize(d.offsetFunction)))},p=function(b){var c=a.util.parseJquery(b),d=c.datagrid("options");return d.columns&&d.columns.length>1||d.frozenColumns&&d.frozenColumns.length>1},q=function(b,c){var d=a.util.parseJquery(b),e=d.datagrid("options"),f=e._extensions?e._extensions:e._extensions={};e.columnFilter=c,u(d,e,f)},r=function(b,c){function k(){g.filterData=[],x(j,"tree-checkbox1"),h.find(".datagrid-view .datagrid-body tr.datagrid-row").show()}function l(){g.filterData=a.array.clone(f),x(j,"tree-checkbox0"),d.datagrid("unselectAll").datagrid("uncheckAll"),h.find(".datagrid-view .datagrid-body tr.datagrid-row").hide()}function m(b){var c,h,i,j,k,l,m;b&&b.field&&(c=b.field,h=b.value,i=b.selected,j=e.columnFilter&&a.util.likeArray(e.columnFilter.columns)?a.array.filter(e.columnFilter.columns,function(a){return a&&a.field==c?!0:!1}):[],j=j.length?j[0]:null,j=a.extend({field:c,type:"checkbox",precision:1},j||{}),k=String(j.type).toLowerCase(),"checkbox"==k?(l=a.isArray(h)?function(b){return a.array.contains(h,b[c])}:function(a){return a[c]==h},m=a.array.filter(f,l),t(d,e,g,m,i,f)):"slidercaps"==k?C(d,e,g,c,f,a.isArray(h)&&h.length>0?h[0]:h,"<="):C(d,e,g,c,f,a.isArray(h)&&h.length>0?h[0]:h,">="))}var d=a.util.parseJquery(b),e=d.datagrid("options"),f=d.datagrid("getRows"),g=e._extensions?e._extensions:e._extensions={},h=d.datagrid("getPanel"),i=h.find("div.datagrid-header-filter-container div.datagrid-header-filter-item"),j=i.find("div.datagrid-header-filter-item-icon");c?c===!0?k():m(a.extend({field:null,value:null,selected:!0},c)):l()},s=function(b,c){c=a.string.toBoolean(c),alert("导出"+(c?"全部":"当前页")+"数据")},F=function(b,c,d){d=d?d:c._extensions,d.onHeaderContextMenuBak=c.onHeaderContextMenu,c.onHeaderContextMenu=function(e,f){var g,h;e.preventDefault(),a.isFunction(d.onHeaderContextMenuBak)&&d.onHeaderContextMenuBak.apply(this,arguments),g=P(b,c,e),h=H(b,c,d,e,f,g),a.easyui.showMenu(h)}},G=function(b,c,d){d=d?d:c._extensions,d.onRowContextMenuBak=c.onRowContextMenu,c.onRowContextMenu=function(e,f,g){var h,i;e.preventDefault(),a.isFunction(d.onRowContextMenuBak)&&d.onRowContextMenuBak.apply(this,arguments),h=P(b,c,e),i=I(b,c,d,e,f,g,h),a.easyui.showMenu(i)}},R=function(b,c,d){var e=b.datagrid("getPanel"),f=e.find(".datagrid-view .datagrid-header table.datagrid-htable tr.datagrid-header-row td").filter(function(){var b=a(this);return!b.attr("field")||b.attr("colspan")||b.find("div.datagrid-header-check").length?!1:!0}),g=f.find("div.datagrid-cell");g.each(function(){var e=a("<span></span>").addClass("s-btn-downarrow").addClass("datagrid-header-cell-arrow").click(function(f){var m,n,o,g=a(this),h=g.offset(),i=g.outerHeight(),j=g.parent().parent().attr("field"),k=P(b,c,f),l=H(b,c,d,f,j,k);return l.left=h.left,l.top=h.top+i,m=a.easyui.showMenu(l),n=m.menu("options"),o=n.onHide,e.hidable=!1,n.onHide=function(){e.hidable=!0,e.removeClass("datagrid-header-cell-arrow-show"),o.apply(this,arguments)},!1}).appendTo(this);a(this).hover(function(){e.addClass("datagrid-header-cell-arrow-show")},function(){(!a.util.isBoolean(e.hidable)||e.hidable)&&e.removeClass("datagrid-header-cell-arrow-show")})})},W=function(b,c,d){var e=a.util.parseJquery(this),f=e.datagrid("options");return S(e,f),f.url?(b=U(f,b),a.ajax({type:f.method,url:f.url,data:b,dataType:"json",success:function(a){c(a)},error:function(){d.apply(this,arguments)}}),void 0):!1},X=a.fn.datagrid.defaults.onLoadSuccess,Y=function(){a.isFunction(X)&&X.apply(this,arguments);var c=a.util.parseJquery(this),d=c.datagrid("options"),e=d._extensions?d._extensions:d._extensions={};e.filterData=[],u(c,d,e)},Z=a.fn.datagrid.defaults.onResizeColumn,$=function(b){var d,e,f,g,h;a.isFunction(Z)&&Z.apply(this,arguments),d=a.util.parseJquery(this),e=d.datagrid("options"),f=d.datagrid("getColumnOption",b),e.columnFilter&&(g=d.datagrid("getPanel"),h=g.find("div.datagrid-header-filter-container[field="+b+"]"),h.width(f.width))},_={getCellDom:function(a,b){return j(a[0],b)},getCell:function(a,b){return k(a[0],b)},getCellDisplay:function(a,b){return l(a[0],b)},getRowDom:function(a,b){return m(a[0],b)},getRowData:function(a,b){return n(a[0],b)},exportExcel:function(a,b){return a.each(function(){s(this,b)})},sort:function(a,b){return a.each(function(){i(this,b)})},setColumnTitle:function(a,b){return a.each(function(){h(this,b)})},deleteRow:function(a,b){return a.each(function(){f(this,b)})},deleteRows:function(a,b){return a.each(function(){g(this,b)})},findRow:function(a,b){return d(a[0],b)},findRows:function(a,b){return c(a[0],b)},setOffset:function(a,b){return a.each(function(){o(this,b)})},hasMuliRowHeader:function(a){return p(a[0])},setColumnFilter:function(a,b){return a.each(function(){q(this,b)})},columnFilterSelect:function(a,b){return a.each(function(){r(this,b)})}},ab={enableExport:!1,headerContextMenu:null,rowContextMenu:null,offset:null,columnFilter:null,loader:W,onLoadSuccess:Y,onResizeColumn:$};a.extend(a.fn.datagrid.defaults,ab),a.extend(a.fn.datagrid.methods,_),bb=".datagrid-header-row td .datagrid-cell { white-space: nowrap; }.datagrid-header-cell-arrow { display: inline-block; float: right; cursor: pointer; border-left-style: dotted; border-left-width: 0px; filter: alpha(opacity=0); opacity: 0; }.datagrid-header-cell-arrow-show { border-left-width: 1px; filter: alpha(opacity=80); opacity: 0.8; }.datagrid-header-filter { overflow: auto; }.datagrid-header-filter { text-align: center; vertical-align: top; }.datagrid-header-filter-line { border-width: 0px; border-top-width: 1px; border-style: dotted; border-color: #ccc; margin-top: 3px; margin-bottom: 3px; }.datagrid-header-filter-container { padding-top: 5px; overflow: auto; font-size: 11px; text-align: left; }.datagrid-header-filter-item { overflow: hidden; padding: 0px; margin: 0px; cursor: pointer; white-space: nowrap; margin: 2px; }.datagrid-header-filter-item:hover { filter: alpha(opacity=60); opacity: 0.6; }.datagrid-header-filter-item-text { padding-left: 20px; float: left; }.datagrid-header-filter-item-icon { left: 2px; top: 50%; width: 16px; height: 16px; margin-top: -3px; }.datagrid-header-filter-itemwrap { overflow: hidden; padding-left: 5px; cursor: pointer; white-space: nowrap; height: 20px; }.datagrid-header-filter-slider { }.datagrid-header-filter-sliderwrap { overflow: hidden; padding-left: 30px; padding-top: 15px; }.datagrid-header-filter-sliderwrap .slider-rulelabel span { font-size: 11px; }.datagrid-header-filter-numeric { width: 60px; height: 12px; font-size: 11px; }",a.util.addCss(bb)}(jQuery);